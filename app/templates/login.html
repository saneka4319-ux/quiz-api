{% extends "base.html" %}

{% block title %}–í—Ö–æ–¥ ‚Äî Quiz API{% endblock %}

{% block content %}
<div class="card">
  <h2>üîê –í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç</h2>
  <form id="loginForm">
    <div class="field">
      <label for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
      <input type="text" id="username" name="username" required>
    </div>
    <div class="field">
      <label for="password">–ü–∞—Ä–æ–ª—å</label>
      <input type="password" id="password" name="password" required minlength="6">
    </div>
    <button type="submit" class="btn">–í–æ–π—Ç–∏</button>
    <p style="margin-top: 1rem;">
      –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="/register" style="color: var(--primary);">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
    </p>
    {% if error %}
      <div class="error">{{ error }}</div>
    {% endif %}
  </form>
</div>

<script>
  document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const res = await fetch('/auth/token', {
      method: 'POST',
      headers: {'Content-Type': 'application/x-www-form-urlencoded'},
      body: new URLSearchParams({username, password})
    });
    if (res.ok) {
      const data = await res.json();
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –≤ –∫—É–∫–µ (–¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞)
      document.cookie = `token=${data.access_token}; path=/; max-age=1800`;
      window.location.href = '/quizzes';
    } else {
      const err = await res.json();
      alert('–û—à–∏–±–∫–∞: ' + (err.detail || '–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ'));
    }
  });
</script>
{% endblock %}